<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherSketch | Technical Generator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background-color: #f0f2f5; }
        
        /* Sidebar */
        #sidebar { width: 350px; background: #fff; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 10; }
        h2 { color: #333; margin-top: 0; }
        textarea { width: 100%; height: 200px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; font-family: monospace; resize: vertical; }
        button { background: #0066cc; color: white; border: none; padding: 10px; margin-top: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #0052a3; }
        button.secondary { background: #444; margin-top: 5px; }
        
        /* Controls */
        .controls { display: flex; gap: 5px; margin-top: 10px; }
        .controls button { flex: 1; margin-top: 0; background: #666; }

        /* Main View */
        #main { flex-grow: 1; position: relative; overflow: hidden; background-image: radial-gradient(#ddd 1px, transparent 1px); background-size: 20px 20px; display: flex; align-items: center; justify-content: center; }
        
        /* Canvas */
        #canvas-container { 
            background: white; border: 2px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.2); 
            padding: 0; transition: transform 0.2s ease; transform-origin: center;
            display: flex; align-items: center; justify-content: center;
        }
        
        /* Gallery */
        #gallery-section { margin-top: 20px; overflow-y: auto; flex-grow: 1; border-top: 1px solid #eee; padding-top: 10px; }
        .saved-item { background: #f8f9fa; padding: 10px; margin-bottom: 5px; border-radius: 4px; cursor: pointer; font-size: 14px; display: flex; justify-content: space-between; border: 1px solid #eee; }
        .saved-item:hover { background: #e2e6ea; border-color: #ccc; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>AetherSketch V2.0</h2>
        <p style="font-size: 12px; color: #666;">Paste Silas's SVG Code below:</p>
        <textarea id="inputCode" placeholder="Paste code here..."></textarea>
        
        <button onclick="renderDrawing()">Generate View</button>
        
        <div class="controls">
            <button onclick="zoom(0.1)">Zoom In (+)</button>
            <button onclick="zoom(-0.1)">Zoom Out (-)</button>
            <button onclick="resetZoom()">Reset</button>
        </div>

        <button class="secondary" onclick="saveToGallery()">Save to Project</button>
        
        <div id="gallery-section">
            <h3>Project Gallery</h3>
            <div id="gallery-list"></div>
        </div>
    </div>

    <div id="main">
        <div id="canvas-container">
            <div id="drawing-output" style="color:#aaa; padding: 50px;">Waiting for input...</div>
        </div>
    </div>

    <script>
        let currentScale = 1.0;

        window.onload = function() { loadGallery(); };

        function renderDrawing() {
            let code = document.getElementById('inputCode').value.trim();
            
            // ERROR HANDLING: Check if empty
            if (!code) { alert("Please paste some code first!"); return; }

            // AUTO-FIX: Check if they missed the closing tag
            if (code.indexOf('<svg') !== -1 && code.indexOf('</svg>') === -1) {
                console.log("Auto-fixing missing closing tag...");
                code += "</svg>";
            }

            // EXTRACT: Find the SVG part
            const start = code.indexOf('<svg');
            if (start !== -1) {
                const cleanSVG = code.substring(start); // Just take everything from <svg onwards
                document.getElementById('drawing-output').innerHTML = cleanSVG;
                resetZoom(); // Reset view on new drawing
            } else {
                alert("I couldn't find an <svg> tag. Are you sure this is the right code?");
            }
        }

        function zoom(amount) {
            currentScale += amount;
            if (currentScale < 0.2) currentScale = 0.2;
            document.getElementById('canvas-container').style.transform = `scale(${currentScale})`;
        }

        function resetZoom() {
            currentScale = 1.0;
            document.getElementById('canvas-container').style.transform = `scale(1)`;
        }

        function saveToGallery() {
            const code = document.getElementById('inputCode').value;
            if (code.length < 50) { alert("Generate a drawing first!"); return; }
            
            const name = prompt("Name this drawing (e.g., H-305 Surge Drum):");
            if (name) {
                const drawing = { name: name, code: code, date: new Date().toLocaleDateString() };
                let gallery = JSON.parse(localStorage.getItem('aetherGallery') || '[]');
                gallery.push(drawing);
                localStorage.setItem('aetherGallery', JSON.stringify(gallery));
                loadGallery();
            }
        }

        function loadGallery() {
            const list = document.getElementById('gallery-list');
            list.innerHTML = "";
            const gallery = JSON.parse(localStorage.getItem('aetherGallery') || '[]');
            
            gallery.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'saved-item';
                div.innerHTML = `<span>${item.name}</span> <small onclick="deleteItem(event, ${index})">‚ùå</small>`;
                div.onclick = (e) => { 
                    if(e.target.tagName !== 'SMALL') {
                        document.getElementById('inputCode').value = item.code;
                        renderDrawing();
                    }
                };
                list.appendChild(div);
            });
        }

        function deleteItem(e, index) {
            e.stopPropagation(); // Stop the click from opening the drawing
            if(confirm("Delete this drawing?")) {
                let gallery = JSON.parse(localStorage.getItem('aetherGallery') || '[]');
                gallery.splice(index, 1);
                localStorage.setItem('aetherGallery', JSON.stringify(gallery));
                loadGallery();
            }
        }
    </script>
</body>
</html>